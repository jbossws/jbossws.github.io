<!DOCTYPE html>
<html>
    <head>
   <META HTTP-EQUIV='Content-Security-Policy'
         CONTENT="default-src 'none'; object-src 'none'; style-src 'self' https://static.jboss.org ; script-src 'self' https://static.jboss.org ; font-src 'none'; img-src 'self' https://static.jboss.org; base-uri 'none'; form-action 'none'; frame-ancestors 'none' "/>
   <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
   <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
   <meta name="keywords" content="JBoss Web Services"/>
   <meta name="description" content=""/>
   <meta name="author" content=""/>
   <meta name="robots" content="all"/>
   <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8"/>

   <title>JBoss Web Services - JBoss Community</title>

   <link rel="stylesheet" type="text/css" href="/css/clearspace_common.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="/css/stkdefault-styles.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/theme/css/common/org_common.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/css/magnolia/styles.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/theme/css/magnolia/jquery-ui.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/theme/css/magnolia/project.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/theme/css/magnolia/wide.css" media="only screen and (min-width: 1200px)" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/css/jbossdeveloper-thin.css" media="screen, projection" />
   <link rel="stylesheet" type="text/css" href="https://static.jboss.org/css/rhbar.css" media="screen, projection" />
</head>

    <body id="project" class="col-float3 rightcol-layout">
    <div id="rhbar">
   <a class="jbdevlogo" href="https://developers.redhat.com"></a>
   <a class="rhlogo" href="https://www.redhat.com/"></a>
</div>

<div id="wrapper">
   <div id="maincontent-wrapper">

      <div id="top_subnav_branding">
         <div id="banner">

            <div style="z-index: 999; position: absolute; top: 0px; height:15px;">
            </div>

            <div id="projectname">
               JBoss Web Services
            </div>

            <div id="tagline">Web Services Framework for WildFly</div>

         </div>

         <div id="proj_announce">
            <div id="proj_logo"><h2>JBoss WS</h2></div>
            <div id="proj_tagline"><h3>Web Services Framework for WildFly</h3></div>
         </div>

         <div id="proj_nav" class="">
            <ul class="sf-menu">

               <li class="current">
                  <span class="notch">&nbsp;</span>
                  <a href="/index.html" class="menu-title">Overview</a>
               </li>

               <li class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="/downloads" class="menu-title">Downloads</a>
                  <ul class="level1">
                     <li class="leaf"><a href="/downloads-latest"> Latest</a></li>
                     <li class="leaf"><a href="/downloads-4x"> 4.x</a></li>
                     <li class="leaf"><a href="/downloads-3x"> 3.x</a></li>
                  </ul>
               </li>

               <li class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="/docs" class="menu-title">Documentation</a>
               </li>

               <li class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="/blogs" class="menu-title">Blog</a>
               </li>

               <li class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="/community" class="menu-title">Community</a>
               </li>

               <li class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="https://issues.redhat.com/projects/JBWS/issues" class="menu-title">Issue Tracker</a>
                  <ul class="level1 jiralink">
                     <li class="leaf"><a href="https://issues.redhat.com/projects/JBWS/issues">JIRA</a></li>
                  </ul>
               </li>

               <li class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="/sourcecode" class="menu-title">Source Code</a>
                  <ul class="level1">
                     <li class="leaf"><a href="https://github.com/jbossws">GitHub</a></li>
                  </ul>
               </li>

               <li id="buildmenu" class="open">
                  <span class="notch">&nbsp;</span>
                  <a href="/build" class="menu-title">Build</a>
               </li>
            </ul>
         </div>

      </div>
          <div id="wrapper-2">
         <div id="wrap-content">
            <div id="wrapper-3">
               <div id="main-wrapper">
                  <div id="main">
                     <div id="breadcrumb">
                       <span>
                              <a href="/">JBossWS</a>
                                &gt;
                              <a href="/blogs">Blogs</a>
                                &gt;
                              <a href="#">Web Services testing in the cloud - Part II</a>
                       </span>
                     </div><!-- end breadcrumb -->
                     <h3>Web Services testing in the cloud - Part II</h3>
                     <h5>By Rebecca Searls | June 23, 2023</h5>
                     <p></p>
                     <p>This is the second article in a series about the web services team’s
exploration of technologies and strategies for running JBossWS-CXF integration tests in a cloud environment.
<a href="https://jbossws.github.io/2023/06/16/webservices-cloud-testing-p1/">Part I</a> describes the scope of this project.</p>

<h4 id="designing-a-testing-framework">Designing a Testing Framework</h4>

<p>One of the project objectives is to use Maven to generate the testable components and run the tests.  For this initial evaluation there are two test components, an image file containing a web service deployment archive (usually a WAR file) running in WildFly and a JUnit test class that runs outside the image file.  Future test cases will be more complex consisting of several web service images and a single test class.</p>

<p>In proto-typing the testing framework an exiting simple Arquillian based web service integration test will be migrated to this framework.  The complexity of the required modifications will be noted.  In my opinion the fewer the modifications the better.  I have considered creating a mock-arquillian archive that would allow the Arquillian classes referenced in the exiting test class to be ignored.  This would allow the test class to remain unaltered and useable in both Arquillian and the cloud test frameworks.  But it does not seem like a good idea for test clarity and long term code maintenance, so I will be making edits to the test class.</p>

<p>As noted in <a href="https://jbossws.github.io/2023/06/16/webservices-cloud-testing-p1/">Part I</a>, I think the framework should support testing both development and released versions of WildFly. There are 2 strategies that can be used to build the image file.  One is to use a WildFly image provided in <a href="https://quay.io/wildfly">quay.io/wildfly</a> and add the web service
deployment archive to it, creating a new image.  Two, is to generate a version of WildFly on local 
 disk, add the deployment archive to it, use a base <em>docker</em> image, add the WildFly build to that and finally create a new image.
In both test image building strategies the web service deployment archive must be 
available when building the image.  With Arquillian that file is defined within the test class.  It is generated using ShrinkWrap APIs and deployed when the test class runs.  In this image building process the <a href="https://maven.apache.org/plugins/maven-war-plugin/">maven-war-plugin</a> is used to generate the deployment archive.  The corresponding code is removed from the test class.  Generating the deployment archive in this manner also means every test must exist in its own project module.</p>

<p>In addressing the second strategy, generating a version of WildFly on local
disk, <a href="https://docs.wildfly.org/wildfly-maven-plugin/">org.wildfly.plugins:wildfly-maven-plugin</a> is used to generate WildFly from a WildFly feature pack.  To that, the deployment archive is copied into WildFly’s <code class="language-plaintext highlighter-rouge">standalone/deployment</code> directory by the plugin. The wildfly-maven-plugin has been enhanced to run WildFly CLI scripts.  A feature future web service cloud tests will need but is not required for this simple test case.  I find having the WildFly code that is used in the image available locally helpful.  It makes it easy to debug any server issue with the test.</p>

<p>For both strategies <a href="https://dmp.fabric8.io/">io.fabric8:docker-maven-plugin</a> is used to generate a <a href="https://www.docker.com/">docker</a> image from a <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a> provided in the project.  <em>docker-maven-plugin</em> is a versatile plugin with many features and options for generating <em>docker</em> images and configurating the image’s run parameters.  This plugin can be used for testing.  It can start the image in <em>docker</em>, run the test, stop the <em>docker</em> instance and cleanup after the test. However a more complex test case should be created to futher evaluate the capabilies of this plugin to meet the needs of our future test cases.</p>

<p>The plugin recommended using the <a href="https://maven.apache.org/surefire/maven-failsafe-plugin/">maven-failsafe-plugin</a> instead of <a href="https://maven.apache.org/surefire/maven-surefire-plugin/">maven-surefire-plugin</a> in running the integration test because on test failure <em>maven-failsafe-plugin</em> will clean up the <em>docker</em> process and <em>maven-surefire-plugin</em> will not. I encountered an issue using <em>maven-failsafe-plugin</em> in place of <em>maven-surefire-plugin</em>. <em>maven-surefire-plugin</em> runs as a default build process. In order to enable <em>maven-failsafe-plugin</em> to run I had to disable the running of surefire by excluding the test class in the plugin and including the test class in the <em>maven-failsafe-plugin</em>. Also maven-failsafe-plugin requires test method names to either start or end with “IT”, so the test class had to be adjusted accordingly.
While editing the test class I also removed the references to Arquillian annotations, <em>RunAsClient</em> and <em>Deployment</em>, and JUnit annotation <em>RunWith</em>.</p>

<p>A key objective of the testing framework is to be able to run the test suite on any Kubernetes compliant implementation. <em>io.fabric8:docker-maven-plugin</em> does not appear to provide that versatility.  It deploys images to <em>docker</em> only. However I have not found any other plugin that can deploy to any Kubernetes implementation either.</p>

<p>Let’s review the pros and cons of this framework:</p>

<p><em>Pros</em></p>
<ul>
  <li>The test can be built and run via maven.</li>
  <li>The test class does not need extensive editing.</li>
</ul>

<p><em>Cons</em></p>
<ul>
  <li>Each test will required its own project module because a deployment archive must be created.</li>
  <li>There will be a lot of duplicate boilerplate code in the <em>pom.xml</em> files.</li>
  <li>The test class requires some edits.</li>
  <li>There is no generic support for deploying the tests to any Kubernetes implementation.</li>
</ul>

<p>Source code for this proto-type project can be found <a href="https://github.com/rsearls/blog-posts/tree/master/blog-mvn-wfly-plugin">here</a>.</p>



                  </div><!-- end main -->
               </div>

    <div id="rightcolumn" class="column">

    <div class="projectpage-socialmedia">
        <span class="st_sharethis_large">&nbsp;</span>
        <span class="st_facebook_large">&nbsp;</span>
        <span class="st_twitter_large">&nbsp;</span>
        <span class="st_linkedin_large">&nbsp;</span>
        <span class="st_email_large">&nbsp;</span>
    </div>


    <div id="proj_quick-start">
        <h3>Useful Links</h3>
        <ul>
            <li><a href="/downloads-latest/">Download</a></li>
            <li><a href="/docs">Documentation</a></li>
            <li><a href="/blogs">Blog</a></li>
            <li><a href="https://issues.redhat.com/browse/JBWS">JIRA</a></li>
            <li><a href="https://github.com/jbossws">Code</a></li>
            <li><a href="https://github.com/jbossws/jbossws-cxf/discussions">Discussion</a></li>
        </ul>
    </div>

    <div class="clear"><br/></div>

    <div class="uploaded-img">

        <a href="https://www.ej-technologies.com/products/jprofiler/overview.html">

            <img width="180" alt="" height="75"
                 src="/img/logo_jprofiler01.gif"
                 style="margin:0 auto;"/>

        </a>
    </div>

    <h5>We use JProfiler for profiling</h5>

    <table>
        <tr>
            <td>
            </td>
        </tr>
    </table>


    <div>
        <a href="https://www.jboss.org/security.html">
            <div class="projectpage-sprite projectpage-sprite-securityimage">&nbsp;</div>
        </a>
    </div>
</div>

</div><!-- end wrapper-3 -->

</div><!-- end wrapper-content -->
<div style="clear: both;"></div>
</div><!-- end wrapper-2 -->
</div>
       <div id="site-info">
      <div>
      </div>

      <div class="footer">
         <div class="container" id="companyfooter">
            <div class="redhatlogo" style="text-align:center;">
               <div id="logospacer"></div>
               <a href="https://www.redhat.com/">
                  <img src="https://static.jboss.org/images/rhbar/redhatlogo.png">
               </a>
            </div>
         </div>
      </div>
   </div><!-- end site-info -->
</div><!-- end wrapper -->

    </body>
</html>
